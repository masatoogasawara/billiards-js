/*
 billiards.js
 Copyright (c) 2018 mimonelu
 http://mimonelu.net/billiards-js/
 This software is released under the MIT License.
 http://opensource.org/licenses/mit-license.php
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,a){b!=Array.prototype&&b!=Object.prototype&&(b[e]=a.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,e,a,c){if(e){a=$jscomp.global;b=b.split(".");for(c=0;c<b.length-1;c++){var d=b[c];d in a||(a[d]={});a=a[d]}b=b[b.length-1];c=a[b];e=e(c);e!=c&&null!=e&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(b,a,c){var d=this.length||0;0>a&&(a=Math.max(0,d+a));if(null==c||c>d)c=d;c=Number(c);0>c&&(c=Math.max(0,d+c));for(a=Number(a||0);a<c;a++)this[a]=b;return this}},"es6","es3");
var _createClass=function(){function b(b,a){for(var c=0;c<a.length;c++){var d=a[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(b,d.key,d)}}return function(e,a,c){a&&b(e.prototype,a);c&&b(e,c);return e}}(),_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"===typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};
function _classCallCheck(b,e){if(!(b instanceof e))throw new TypeError("Cannot call a class as a function");}
(function(b,e){"function"===typeof define&&define.amd?define([],e):"object"===("undefined"===typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e():b.Billiards=e()})(window,function(){var b={frandom:function(b,a){return Math.random()*(a-b)+b},irandom:function(b,a){return Math.floor(Math.random()*(a-b+1))+b},lerp:function(b,a,c){return(1-c)*b+c*a},normalize:function(b){var a=b.x,c=b.y;b.x=a/Math.sqrt(a*a+c*c);b.y=c/Math.sqrt(a*a+c*c)}};return function(){function e(a){_classCallCheck(this,
e);this._=a;this.active=!1!==this._.active;this.setupCanvas();this.setupSprites();!1!==this._.autoPlay&&this.tick()}_createClass(e,[{key:"setupCanvas",value:function(){var a=this;this.canvas=null!=this._.canvas?this._.canvas:document.createElement("canvas");this.context=this.canvas.getContext("2d");null!=this._.width&&this.canvas.setAttribute("width",this._.width);null!=this._.height&&this.canvas.setAttribute("height",this._.height);this.parent=this._.parent||document.body;if(this._.fitToParentW||
this._.fitToParentH||this._.fitToWindow)this.resize(),window.addEventListener("resize",function(){a.resize();a.resizeSprite()});null==this._.canvas&&this.parent.appendChild(this.canvas)}},{key:"setupSprites",value:function(){this.sprites=[];for(var a=0;a<(null!=this._.number?this._.number:3);a++)this.sprites[a]={index:a,x:this.canvas.width*(null!=this._.x?b.frandom(this._.x[0],this._.x[1]):Math.random()),y:this.canvas.height*(null!=this._.y?b.frandom(this._.y[0],this._.y[1]):Math.random()),r:0,color:null!=
this._.color?"rgba("+b.irandom(this._.color.r[0],this._.color.r[1])+", "+b.irandom(this._.color.g[0],this._.color.g[1])+", "+b.irandom(this._.color.b[0],this._.color.b[1])+", "+b.frandom(this._.color.a[0],this._.color.a[1])+")":"rgba("+b.irandom(0,255)+", "+b.irandom(0,255)+", "+b.irandom(0,255)+", "+b.frandom(0,1)+")",vector:{x:b.frandom(-1,1),y:b.frandom(-1,1)},velocity:null!=this._.velocity?b.frandom(this._.velocity[0],this._.velocity[1]):b.frandom(.1,1)},b.normalize(this.sprites[a].vector);this.resizeSprite()}},
{key:"resize",value:function(){this._.fitToParentW?this.canvas.setAttribute("width",this.parent.clientWidth):this._.fitToWindow&&this.canvas.setAttribute("width",window.innerWidth);this._.fitToParentH?this.canvas.setAttribute("height",this.parent.clientHeight):this._.fitToWindow&&this.canvas.setAttribute("height",window.innerHeight)}},{key:"resizeSprite",value:function(){for(var a=(this.canvas.width+this.canvas.height)/2,c=0;c<this.sprites.length;c++)this.sprites[c].r=a*(null!=this._.r?b.frandom(this._.r[0],
this._.r[1])/2:b.frandom(.1,.4))}},{key:"tick",value:function(){var a=this;requestAnimationFrame(function(){a.update();a.tick()})}},{key:"update",value:function(){this.active&&(this.updateBackground(),this.updateSprites())}},{key:"updateBackground",value:function(){null==this._.fillStyle?this.context.clearRect(0,0,this.canvas.width,this.canvas.height):(this.context.fillStyle=this._.fillStyle,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))}},{key:"updateSprites",value:function(){for(var a=
0;a<this.sprites.length;a++)this.translateSprite(this.sprites[a],"x","width"),this.translateSprite(this.sprites[a],"y","height"),!1!==this._.collide&&this.collideToOthers(this.sprites[a]),this.collideToBounds(this.sprites[a],"x","width"),this.collideToBounds(this.sprites[a],"y","height"),this.context.save(),null!=this._.render?this._.render(this,this.sprites[a]):this.renderSprite(this.sprites[a]),this.context.restore()}},{key:"translateSprite",value:function(a,b,d){a[b]+=a.vector[b]*a.velocity}},
{key:"collideToOthers",value:function(a){for(var c=0;c<this.sprites.length;c++)if(a.index!==c){var d=this.sprites[c],e=Math.atan2(d.x-a.x,d.y-a.y),f=Math.sqrt((d.x-a.x)*(d.x-a.x)+(d.y-a.y)*(d.y-a.y))-(a.r+d.r+(this._.margin||0));if(0>f){var g=d.r/(a.r+d.r),h=a.r/(a.r+d.r),k=Math.sin(e)*f/2;f=Math.cos(e)*f/2;a.x+=k*g;a.y+=f*g;d.x-=k*h;d.y-=f*h;!1!==this._.rebound&&(a.vector.x=b.lerp(a.vector.x,-Math.sin(e),g),a.vector.y=b.lerp(a.vector.y,-Math.cos(e),g),b.normalize(a.vector),d.vector.x=b.lerp(d.vector.x,
Math.sin(e),h),d.vector.y=b.lerp(d.vector.y,Math.cos(e),h),b.normalize(d.vector))}}}},{key:"collideToBounds",value:function(a,b,d){a[b]<a.r?(a[b]=a.r,a.vector[b]*=-1):a[b]>this.canvas[d]-a.r&&(a[b]=this.canvas[d]-a.r,a.vector[b]*=-1)}},{key:"renderSprite",value:function(a){this.context.fillStyle=a.color;this._.composite&&(this.context.globalCompositeOperation=this._.composite);this.context.beginPath();this.context.arc(a.x,a.y,a.r,0,2*Math.PI);this.context.closePath();this.context.fill()}},{key:"start",
value:function(){this.active=!0}},{key:"stop",value:function(){this.active=!1}},{key:"reset",value:function(){this.setupSprites()}}]);return e}()});
